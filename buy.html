<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Checkout - GameZone</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">

  <style>
    body {
      background-color: #f8f9fa;
    }

    .product-img {
      height: 300px;
      object-fit: cover;
    }
  </style>
</head>

<body>
  <div class="container my-5">
    <div class="row justify-content-center">
      <div class="col-md-6">
        <div class="card shadow-lg border-0">
          <div class="card-header bg-primary text-white text-center">
            <h3>Checkout</h3>
          </div>
          <div class="card-body">
            <div class="text-center mb-4">
              <img src="" class="img-fluid product-img mb-3" alt="Game Image">
              <h4></h4>
              <p class="fw-bold text-success"></p>
            </div>

            <form>
              <div class="mb-3">
                <label for="name" class="form-label">Full Name</label>
                <input type="text" class="form-control" id="name" placeholder="Enter your name" required> 
              </div>
              <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <input type="email" class="form-control" id="email" placeholder="Enter your email" required>
              </div>
              <div class="mb-3">
                <label for="payment" class="form-label">Payment Method</label>
                <select class="form-select" id="payment">

                  <option value="credit">Credit Card</option>
                  <option value="paypal">PayPal</option>
                </select>
              </div>
              <button type="submit" class="btn btn-success w-100" onclick="buyGame()"><i class='bx bx-check-circle'></i>
                Confirm Purchase</button>
              <a href="index.html" class="btn btn-secondary w-100 mt-2">Cancel</a>
            </form>

            <div class="mt-3 text-center text-muted small">
              By clicking confirm, you agree to our <a href="#">terms & conditions</a>.
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script>
    // Function to load product details from session storage
    function loadProductDetails() {
      // 1. Get the product data from sessionStorage and parse the JSON string
      const productJSON = sessionStorage.getItem('checkoutProduct');

      // Check if data exists
      if (!productJSON) {
        console.error("No product data found in session storage.");
        // Update page to show error state
        const titleElement = document.querySelector('.card-body h4');
        const priceElement = document.querySelector('.card-body p.fw-bold');
        if (titleElement) titleElement.textContent = 'Error: No Product Selected';
        if (priceElement) priceElement.textContent = 'Please go back to the shop.';
        return;
      }

      const product = JSON.parse(productJSON);

      // 2. Update the HTML elements with the retrieved data
      const productImgElement = document.querySelector('.product-img');
      const productTitleElement = document.querySelector('.card-body h4');
      const productPriceElement = document.querySelector('.card-body p.fw-bold');

      if (productImgElement) {
        productImgElement.src = product.image; // Set the image source
      }

      if (productTitleElement) {
        productTitleElement.textContent = product.name; // Set the title
      }

      if (productPriceElement) {
        productPriceElement.textContent = product.price; // Set the price
      }
    }



    // Run the function when the page loads
    window.onload = loadProductDetails;
  </script>

  <script>
    // 1. Load the product details from session storage
    const productJSON = sessionStorage.getItem('checkoutProduct');
    const product = productJSON ? JSON.parse(productJSON) : null;
    const gameName = product ? product.name : "Unknown Game";

    // This was to set an element with ID 'gameTitle' which doesn't exist on the page.
    // document.getElementById('gameTitle').textContent = gameName || "Unknown Game"; 

    function buyGame() {
      if (!gameName || gameName === "Unknown Game") return alert("No game selected for purchase.");

      // Get existing inventory or empty array
      let inventory = JSON.parse(localStorage.getItem('inventory')) || [];
      if (!inventory.includes(gameName)) {
        inventory.push(gameName);
        localStorage.setItem('inventory', JSON.stringify(inventory));
        alert(`${gameName} added to your inventory!`);
      } else {
        alert(`${gameName} is already in your inventory.`);
      }

      // Redirect to inventory page
      window.location.href = 'inventory.html';
    }
  </script>
</body>

</html>